<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="ICS_Project.App.Views.Playlist.PlaylistDetailView"
             xmlns:playlist_vm="clr-namespace:ICS_Project.App.ViewModels.Playlist"
             xmlns:models="clr-namespace:ICS_Project.BL.Models;assembly=ICS_Project.BL"
             x:DataType="playlist_vm:PlaylistDetailViewModel">

    <Grid RowDefinitions="Auto, Auto, *"
          BackgroundColor="{StaticResource PageBackgroundColor}"
          RowSpacing="5"
          Padding="0"
          Margin="0"
          >

        <Border Grid.Row="0"
                Margin="10,10,10,5"
                Padding="10"
                StrokeThickness="1"
                Stroke="{StaticResource Tertiary}">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="15"/>
            </Border.StrokeShape>
            <Border.Background>
                <RadialGradientBrush Center="0.5,-0.1" 
                                      Radius="0.53"
                                      >
                    <GradientStop Color="{StaticResource Gradient1}" Offset="0.0" />
                    <GradientStop Color="{StaticResource Gradient2}" Offset="1.0" />
                </RadialGradientBrush>
            </Border.Background>

            <Grid ColumnDefinitions="Auto, *, Auto">
                <Image Grid.Column="0"
                       Source="redhotchilli.png"
                       WidthRequest="150"
                       HeightRequest="150"
                       Aspect="AspectFill"
                       VerticalOptions="Start"/>

                <StackLayout Grid.Column="1" Margin="10,0,10,0" VerticalOptions="Start">
                    <Label Text="{Binding PlaylistHeaderDetails.Name}" FontSize="Large" FontAttributes="Bold"/>
                    <HorizontalStackLayout Spacing="5">
                        <Label Text="autor: " VerticalOptions="Center"/>
                        <Label Text="Vlastny" FontAttributes="Bold" VerticalOptions="Center"/>
                        <Label Text=" | " VerticalOptions="Center"/>
                        <Label Text="{Binding PlaylistHeaderDetails.NumberOfMusicTracks}" VerticalOptions="Center"/>
                        <Label Text=" skladeb" VerticalOptions="Center"/>
                        <Label Text=" | " VerticalOptions="Center"/>
                        <Label Text="{Binding PlaylistHeaderDetails.TotalPlayTime}" VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                    <Label Text="{Binding PlaylistHeaderDetails.Description}" FontSize="Small" FontAttributes="Italic" Margin="0,5,0,0"/>
                </StackLayout>

                <Button Grid.Column="1
                        " Text="..." 
                        WidthRequest="40" 
                        HeightRequest="40" 
                        VerticalOptions="Start" 
                        Command="{Binding ModifyTrackCommand}"/>


                <Button x:Name="OptionsButton"
                        Grid.Column="2"
                        Text="Customize"
                        WidthRequest="105"
                        HeightRequest="35"
                        VerticalOptions="Start"
                        Command="{Binding ShowOptionsCommand}"
                        CommandParameter="{Binding Source={RelativeSource Self}}"
                        />
            </Grid>
        </Border>


        <Border Grid.Row="1"
                Margin="10,0,10,5"
                Padding="10"
                StrokeThickness="1"
                Stroke="{StaticResource Tertiary}">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="8"/>
            </Border.StrokeShape>
            <Border.Background>
                <RadialGradientBrush Center="0.5,0.5"
                                     Radius="2"
                                      >
                    <GradientStop Color="{StaticResource Gradient2}" Offset="0.0" />
                    <GradientStop Color="{StaticResource Gradient2}" Offset="1.0" />
                </RadialGradientBrush>
            </Border.Background>

            <Grid ColumnDefinitions="*, Auto">
                <SearchBar Grid.Column="0" Placeholder="Prohledat playlist" Text="Vyhladavanie"/>
                <Button Grid.Column="1" 
                        Text="Add track" 
                        />
            </Grid>
        </Border>


        <Border Grid.Row="2"
                Margin="10,0,10,10"
                Padding="10"
                StrokeThickness="1"
                Stroke="{StaticResource Tertiary}">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="8"/>
            </Border.StrokeShape>
            <Border.Background>
                <RadialGradientBrush Center="0.5,1.1"
                                     Radius="0.53"
                                      >
                    <GradientStop Color="{StaticResource Gradient1}" Offset="0.0" />
                    <GradientStop Color="{StaticResource Gradient2}" Offset="1.0" />
                </RadialGradientBrush>
            </Border.Background>

            <Grid RowDefinitions="auto, *">
                <Grid Grid.Row="0" ColumnDefinitions="Auto, *, *, *, *, auto" Margin="0,0,0,5">
                    <Label Grid.Column="0" Text="#" Margin="0,0,5,0"/>
                    <Label Grid.Column="1" Text="Název" HorizontalOptions="Start"/>
                    <Label Grid.Column="2" Text="Umělec" HorizontalOptions="Start"/>
                    <Label Grid.Column="3" Text="Velkost" HorizontalOptions="Start"/>
                    <Label Grid.Column="4" Text="Délka" HorizontalOptions="Start"/>
                    <Label Grid.Column="5" Text=""/>
                </Grid>

                <CollectionView Grid.Row="1" ItemsSource="{Binding MusicTrackVMs}">
                    <!-- Corrected Binding -->
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="playlist_vm:PlaylistTrackViewModel">
                            <!-- x:DataType matches item type -->
                            <Grid ColumnDefinitions="Auto, *, *, *, *, auto" Padding="0,2">
                                <Image Grid.Column="0" Source="redhotchilli.png" WidthRequest="30" HeightRequest="30" Aspect="AspectFit" VerticalOptions="Center" Margin="0,0,5,0"/>


                                <Label Grid.Column="1" Text="{Binding Title}" VerticalOptions="Center">
                                    <Label.Style>
                                        <Style TargetType="Label">
                                            <Setter Property="TextColor" Value="{StaticResource PrimaryTextColor}" />
                                            <Setter Property="TextDecorations" Value="Underline" />
                                            <Style.Triggers>
                                                <Trigger TargetType="Label" Property="IsFocused" Value="True">
                                                    <Setter Property="TextColor" Value="{StaticResource Tertiary}" />
                                                </Trigger>
                                                <!-- You might need custom logic for hover/pressed states if not inherently supported -->
                                            </Style.Triggers>
                                        </Style>
                                    </Label.Style>
                                    <Label.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding MusicTrackShowDetailMessageCommand}" CommandParameter="{Binding .}" />
                                    </Label.GestureRecognizers>
                                </Label>



                                <Label Grid.Column="2" Text="Autor" VerticalOptions="Center"/>
                                <!-- Assuming 'Autor' is static or from a property in PlaylistTrackViewModel -->
                                <Label Grid.Column="3" Text="{Binding Size}" VerticalOptions="Center"/>
                                <Label Grid.Column="4" Text="{Binding Length}" VerticalOptions="Center"/>
                                <Button Grid.Column="4"
                                        Text="···"
                                        FontSize="11"
                                        WidthRequest="37"
                                        HeightRequest="35"
                                        VerticalOptions="Center"
                                        Command="{Binding MusicTrackShowOptionsMessageCommand}"
                                    CommandParameter="{Binding Source={RelativeSource Self}}"/>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </Border>

    </Grid>
</ContentView>